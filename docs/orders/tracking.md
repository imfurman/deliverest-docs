# Мониторинг доставки

Deliverest визуализирует доставку в модуле `OrdersMapController` и в мобильном приложении курьеров.

## Карта заказов

- Доступна по адресу `/admin/orders_map`.
- Загружает данные через сервис `orders_map_manager`, который формирует тепловые карты по датам.
- Поддерживает сравнение с предыдущими периодами (`fromDiff` / `toDiff`) для анализа трендов.
- Карточки заказов кликабельны: отсюда можно открыть заказ, посмотреть маршрут и связаться с курьером.

## Карта курьеров

- `/admin/couriersMap` отображает активных курьеров, их статус (доставка, на базе, свободен) и количество заказов в пути.
- Курьеры передают координаты через API `Superdostavka\ApiBundle\Controller\CourierApi\CommonController`.
- Цвет индикатора зависит от SLA: зелёный — вовремя, жёлтый — риск, красный — просрочено.

### Настройки карты

- В конфиге `project.couriers_map.orders.enabled` можно добавить на карту активные адреса заказов — удобно видеть плотность доставок в реальном времени.
- Параметр `project.operator.filter_by_city` ограничивает операторов их городом обслуживания: карта и список покажут только релевантные заказы.
- Для работы в мультигороде включите `project.multicity.enabled` и настройте список городов в разделе [Города](../settings/cities.md).

## Уведомления и SLA

- Настройте пороги в разделе [Производительность](../settings/performance.md), чтобы диспетчер получал уведомления до нарушения SLA.
- События доставляются в панель в режиме реального времени через вебсокеты (Redis pub/sub).

## Отчётность

- Исторические данные по маршрутам доступны в отчётах `Отчет по цехам`, `Курьеры на карте` и `Водители по дням`.
- Для deeper-аналитики используйте экспорт в CSV/JSON и анализируйте данные в BI-системах.
