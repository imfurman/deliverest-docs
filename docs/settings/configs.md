# Конфигурации

Раздел `/admin/config` хранит низкоуровневые настройки Deliverest. Каждая запись — это `slug` c JSON-содержимым. Через них включаются модули, меняется логика заказа и интерфейс витрины.

## Где искать нужный `slug`

- `project` — основная «панель тумблеров»: витрина, оформление заказа, логистика, уведомления.
- `order_flow`, `operator-panel-links`, `push_settings` и другие специализированные конфиги продолжают работать, но многие сценарии теперь проще включить через `project`.
- Для шаблонов витрины и контента используйте `site`, `slider`, `templates`; для мобильных приложений — `mobile_config`.

## Как безопасно редактировать JSON

1. Используйте встроенный валидатор и предварительный просмотр diff перед сохранением.
2. Перед крупными изменениями выгружайте текущий JSON (кнопка «Экспорт») — это быстрый бэкап.
3. Изменения вступают в силу сразу. Если правите продакшн, делайте это вне пиковых часов или сначала протестируйте на стейдже.

## Популярные переключатели

Большинство ключей ниже лежат в конфиге `project`. Структура JSON вида `{"block": {"option": true}}` сохранена для удобства.

### Витрина и маркетинг

| Переключатель | Что меняется | Когда включать |
| --- | --- | --- |
| `project.new_site_disable_actions_link` | Убирает ссылку «Акции» из верхнего меню новой вёрстки. | Если витрина акций переехала в мобильное приложение или на лендинг. |
| `project.top_menu_as_links.enabled` | Каждый пункт верхнего меню открывается как отдельная страница, а не якорь. | Когда разделы имеют длинный контент и удобнее выделить отдельные URL. |
| `project.left_menu.enabled` | Добавляет вертикальное меню в каталоге. | Для сетей с большим ассортиментом, где нужна навигация по подкатегориям. |
| `project.tags.enabled` | Показывает теги на главной (например, «Новинка», «Комбо»). | Чтобы выделить спецпредложения без правки шаблонов. |
| `project.header_mobile_apps.enabled` | Включает баннер «Скачай приложение» (+ `full_size_banner` для фонового изображения и текста). | Когда нужно поднять установки мобильных приложений. |
| `project.smart.recommend.recommend.enabled` | Включает блок рекомендаций в корзине, `test: true` ограничивает показ сотрудникам. | Для повышения среднего чека и A/B тестов кросс-сейла. |
| `project.chef_gift.enabled` | Активирует модуль «Подарок от шефа» на витрине и в заказе. | Используйте вместе с подарочными позициями, чтобы автоматически подставлять подарок. |

### Оформление заказа и оплаты

| Переключатель | Что меняется | Когда включать |
| --- | --- | --- |
| `project.order_page.contactless_delivery` | Добавляет чекбокс «Бесконтактная доставка» и фиксирует выбор в комментарии к заказу. | Если курьеры должны знать, что заказ нужно оставить у двери. |
| `project.order_price_increase_only.enabled` + `allowed_role` | Блокирует понижение суммы заказа для операторов ниже указанной роли. | Для строгого контроля скидок и предотвращения ошибок. |
| `project.promocodes.enabled` | Показывает поле ввода промокода на сайте и в приложении. | Когда запускаете кампании с кодами или работает лояльность. |
| `project.delivery_type_datepicker.enabled` | Даёт клиенту календарь выбора даты/времени («Точно ко времени»). | Для предзаказов, корпоративного питания, праздничных заказов. |
| `project.pickup` (sms / push / workshop_in_sms / takeaway_option) | Управляет сценариями самовывоза: уведомления о готовности, выбор типа. | Если у вас есть витрины самовывоза и нужно информировать клиента. |
| `project.pay_online.enabled` + `gate`, `payment_icon_names`, `sbp` | Включает онлайн-оплату, задаёт платёжный шлюз и отображаемые иконки, подключает СБП. | При работе с Сбербанк, ЮKassa, Альфа-Банк и др. |
| `project.multiple_payment_entities.enabled` | Требует выбора юрлица при онлайн-оплате и делает адрес обязательным. | Когда для разных брендов нужны отдельные расчётные счета и чеки. |
| `project.pay_types` | Управляет списком способов оплаты на сайте (наличные, карта курьеру и т.д.). | При запуске или отключении каналов оплаты. |

### Коммуникации и клиентский сервис

| Переключатель | Что меняется | Когда включать |
| --- | --- | --- |
| `project.notifications.push` | Позволяет отправлять сервисные сообщения клиентам через push, даже если SMS выключены. | Если продвигаете мобильное приложение и хотите экономить на SMS. |
| `project.working_schedule.show_modal` | Показывает всплывающий баннер с часами работы при заходе на сайт. | Полезно при смене расписания, ремонте или праздниках. |
| `project.new_order_notification.enabled` | Включает звуковое уведомление о новом заказе в операторской панели. | Чтобы операторы не пропускали заказы при работе в нескольких вкладках. |
| `project.new_order_sms.numbers` | Отправляет SMS-оповещение о новом заказе на список номеров. | Для менеджеров смены или владельцев, которые хотят мгновенные уведомления. |
| `project.feedback` (`enabled`, `push`) | Активирует модуль пост-доставочного фидбэка и пуш-напоминания об оценке. | Чтобы собирать отзывы и запускать NPS. |
| `project.order_frequency` и `project.frequency_limit` | Ограничивают количество заказов/авторизаций с одного IP и частоту SMS. | Для защиты от ботов и спама при массовых акциях. |

### Операции и контроль

| Переключатель | Что меняется | Когда включать |
| --- | --- | --- |
| `project.couriers_map.orders.enabled` | Отображает активные заказы на карте курьеров. | Когда диспетчеру удобнее видеть привязку адресов к курьерам. |
| `project.operator.filter_by_city` | Фильтрует список заказов по городу оператора. | Если у вас мультигород и операторы работают только со своим регионом. |
| `project.multicity.enabled` | Добавляет выбор города на сайте и в админке. | Для сетей с несколькими городами обслуживания. |
| `project.performance.enabled` | Включает модуль SLA и отчёты по производительности. | Для контроля кухонь и курьеров по KPI. |
| `project.orders_xml_export.enabled` + `file_merchant_name` | Создаёт XML-файлы заказов в `/web/<project>/ftp/orders`. | Для обмена с франчайзи, ERP или внешними аналитическими системами. |
| `project.cloud_print.enabled` | Настраивает облачную печать чеков по статусу (например, «Готово к выдаче»). | Если используете удалённые или мобильные принтеры. |
| `project.shift` (`time`, `courierTime`, `delta`) | Сдвигает начало операционной смены для операторов и курьеров. | Когда рабочий день начинается не в 05:00 и нужно видеть пограничные заказы. |
| `project.courier.courier_needed_to_sent_order` | Требует назначить курьера перед сменой статуса «Отправлен». | Чтобы исключить ситуации, когда заказ уходит без исполнителя. |
| `project.bill.width` | Задаёт ширину печати чека (например, для формата А4). | Подходит для офлайн-точек с нетиповыми принтерами. |

### Дополнительные настройки

- `project.sip` — параметры IP-телефонии (домен, токен). После включения привяжите операторов в разделе «Телефония».
- `project.additional_discount` — разрешает операторам выдавать фиксированные скидки по своему усмотрению.
- `project.header_mobile_apps.full_size_banner` — фон, тексты и ссылки для промо баннера с приложениями.
- `project.orders_map` и `project.bottom_cart` — кастомизация отображения карты и корзины в витрине.

## Контроль и безопасность

- Доступ к изменениям конфигов ограничен ролями `ROLE_SUPER_ADMIN` и `ROLE_MARKET_LEAD`; каждое сохранение логируется.
- При ошибке используйте «Вернуться к предыдущей версии» — Deliverest хранит историю правок.
- После включения нового модуля обновите кеш (`php bin/console cache:clear` или преднастроенный скрипт) и сообщите команде о появлении нового функционала.

Правильно задокументированные конфиги экономят время: фиксируйте, какой ключ за что отвечает, и добавляйте ссылку на актуальные сценарии прямо в комментариях к JSON.
